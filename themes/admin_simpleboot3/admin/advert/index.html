<include file="public@header" />
</head>
<body>
	<div class="wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:url('Advert/index')}">广告列表</a></li>
		</ul>
		<form class="well form-inline margin-top-20" method="post" action="{:url('Advert/index')}">
			关键字：
			<input class="form-control" type="text" name="keyword" style="width: 200px;" value="{:input('request.keyword')}"
				   placeholder="会员ID/广告ID">
			广告标题：
			<input class="form-control" type="text" name="title" style="width: 200px;" value="{:input('request.title')}"
				   placeholder="广告标题">

<!--			用户名称：-->
<!--			<input class="form-control" type="text" name="user_nicename" style="width: 200px;" value="{:input('request.user_nicename')}"-->
<!--				   placeholder="用户名称">-->
			<input type="submit" class="btn btn-primary" value="搜索">
			<a class="btn btn-danger" href="{:url('Advert/index')}">清空</a>
		</form>				
		<form method="post" class="js-ajax-form" action="{:url('Advert/listOrder')}">
			<div class="table-actions">
				<button class="btn btn-primary btn-sm js-ajax-submit" type="submit">{:lang('SORT')}</button>
			</div>
			<table class="table table-hover table-bordered">
				<thead>
					<tr>
						<th>权重(越大越靠前)</th>
						<th>ID</th>
						<th>会员昵称（ID）</th>
						<th>标题</th>
						<th>图片</th>
						<th>点赞数</th>
						<th>评论数</th>
						<th>分享数</th>
						<th>广告链接</th>
						<th>到期时间</th>
						<th>发布时间</th>
						<th>{:lang('ACTIONS')}</th>
					</tr>
				</thead>
				<tbody>
					<foreach name="lists" item="vo">
					<tr>
						<td><input name="list_orders[{$vo.id}]" class="input-order" type="text" value="{$vo.orderno}"></td>
						<td>{$vo.id}</td>
						<td>{$vo.userinfo.user_nicename}({$vo.uid})</td>
						<td>{$vo.title}</td>
						<td><img src="{$vo['thumb']}" class="imgtip" style="max-width:100px;max-height:100px;"/></td>
						<td>{$vo.likes}</td>
						<td>{$vo.comments}</td>
						<td>{$vo.shares}</td>
						<td>{$vo.ad_url}</td>
						<td>{:date('Y-m-d H:i:s',$vo['ad_endtime'])}</td>
						<td>{:date('Y-m-d H:i:s',$vo['addtime'])}</td>
						<td align="center">
							<a class="btn btn-xs btn-info view" data-id="{$vo['id']}">观看</a>
							<a class="btn btn-xs btn-primary" href='{:url("Advert/edit",array("id"=>$vo["id"]))}'>{:lang('EDIT')}</a>
							<a class="btn btn-xs btn-warning xiajia" data-id="{$vo['id']}">下架</a>
							<a class="btn btn-xs btn-info comment" data-id="{$vo['id']}">评论列表</a>
							<a class="btn btn-xs btn-danger js-ajax-delete" href="{:url('Advert/del',array('id'=>$vo['id']))}">{:lang('DELETE')}</a>
						</td>
					</tr>
					</foreach>
				</tbody>
			</table>
			<div class="pagination">{$page}</div>

		</form>
	</div>
	<script src="__STATIC__/js/admin.js"></script>
	<script src="__STATIC__/js/layer/layer.js"></script>
	<script type="text/javascript">
		$(function(){

			Wind.use('layer');
			$('.comment').click(function(){
				var _this=$(this);
				var id=_this.data('id');

				layer.open({
					type: 2,
					title: '评论列表',
					shadeClose: true,
					shade: 0.8,
					area: ['800px', '90%'],
					content: '/admin/videocom/index?videoid='+id
				});

			});

			$('.view').click(function(){
				var _this=$(this);
				var id=_this.data('id');

				layer.open({
					type: 2,
					title: '查看',
					shadeClose: true,
					shade: 0.8,
					area: ['500px', '600px'],
					content: '/admin/Advert/see?id='+id
				});

			});

			$('.xiajia').click(function(){
				var _this=$(this);
				var id=_this.data('id');

				layer.prompt({
					formType: 2,
					title: '请输入下架原因',
					area: ['800px', '100px'] //自定义文本域宽高
				}, function(value, index, elem){
					$.ajax({
						url:'{:url('advert/setStatus')}',
							type:'POST',
							data:{id:id,isdel:1,reason:value},
					dataType:'json',
							success:function(data){
						var code=data.code;
						if(code==0){
							layer.msg(data.msg);
							return !1;
						}
						layer.msg(data.msg,{},function(){
							layer.closeAll();
							reloadPage(window);
						});

					},
					error:function(){
						layer.msg('操作失败，请重试')
					}
				});

				});

			})
		})
	</script>
</body>
</html>